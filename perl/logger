#!/usr/bin/perl

#Copyleft (C) Yurnerola

use LWP;
use strict;
use warnings;
use Getopt::Std;

use vars qw($opt_h $opt_i);

open(my $log,">>","logger.log");

print $log "@ARGV\n";

close $log or die "$log:$!";

getopts('hi:') or die usage();

die usage() if $opt_h;
die usage() if !$opt_i;

print "---Content Generated By libwww-perl-$LWP::VERSION---\n\n";

my $browser=LWP::UserAgent->new();
my $response=$browser->get("http://123.103.108.94:18010/fcgi_bin/get_hall_info.fcgi?id=$opt_i");

if ($response->content  =~ /hall_property=(\d+)\n/)
{
	print "Room is locked\n" if ($1&0x02);
}

pinfo($response->content,"gas_ip");
pinfo($response->content,"gas_id");

sub usage {
	return<<'_EOC_';
Usage:
	logger [options]

Options:
	-h              Print this usage.
	-i <hallid>
Example:
	logger -i 447283
_EOC_
}

sub pinfo
{
	if($_[0] =~ /($_[1]=.*)\n/)
	{
		print "$1\n";
	}
}
